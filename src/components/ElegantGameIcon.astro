---
import Image from "astro/components/Image.astro";

export interface Props {
  point: number[];
  img: ImageMetadata;
}

const { point, img } = Astro.props;
const inflationConstant = Math.E;
const target = [0, 0];

// const ma = (controlPoint[1] - point[1]) / (controlPoint[0] - point[0]);
// const mb = (target[1] - controlPoint[1]) / (target[0] - controlPoint[0]);
// https://paulbourke.net/geometry/circlesphere/
// const x =
//   (ma * mb * (point[1] - target[1]) + mb * (point[0] + controlPoint[0]) - ma * (controlPoint[0] + target[0])) /
//   (2 * (mb - ma));
// const y = -(1 / ma) * (x - (point[0] + controlPoint[0]) / 2) + (point[1] + controlPoint[1]) / 2;

// const center = [x, y];
// const radius = Math.sqrt((center[0] - target[0]) ** 2 + (center[1] - target[1]) ** 2);
function fixAngle(angleDeg: number) {
  return center[0] > point[0] ? -(angleDeg + 90) - 90 : angleDeg;
}
const RAD_TO_DEG = 180 / Math.PI;

const deltaX = target[0] - point[0];
const deltaY = target[1] - point[1];

const minDiameter = Math.sqrt(deltaX ** 2 + deltaY ** 2);
const radius = (minDiameter / 2) * inflationConstant;

const midpointX = (target[0] + point[0]) / 2;
const midpointY = (target[1] + point[1]) / 2;

const angle = RAD_TO_DEG * Math.acos((minDiameter ** 2 + radius ** 2 - radius ** 2) / (2 * minDiameter * radius));
const offset = radius * (RAD_TO_DEG * Math.sin(angle));

const reciprocalSlopeX1 = -deltaY;
const reciprocalSlopeY1 = deltaX;
const reciprocalSlopeX2 = deltaY;
const reciprocalSlopeY2 = -deltaX;

const ratio = Math.sqrt(reciprocalSlopeX1 ** 2 + reciprocalSlopeY1 ** 2) / offset;
const x1 = reciprocalSlopeX1 * ratio + midpointX;
const y1 = reciprocalSlopeY1 * ratio + midpointY;

const x2 = reciprocalSlopeX2 * ratio + midpointX;
const y2 = reciprocalSlopeY2 * ratio + midpointY;

const center = x1 > target[0] ? [x1, y1] : [x2, y2];

const angleStart = fixAngle(RAD_TO_DEG * Math.asin((center[1] - point[1]) / radius));
const percentStart = (angleStart / 360) * 100;
const angleEnd = -fixAngle(RAD_TO_DEG * Math.asin((center[1] - target[1]) / radius));
const percentEnd = (angleEnd / 360) * 100;
---

<li
  class="header__game"
  style={{
    "offset-path": `circle(${radius}vmin at calc(50% + ${center[0]}vmin) calc(100% + ${center[1]}vmin))`,
    "--offset": `${percentEnd}%`,
  }}
  data-start-percent={percentStart}
  data-end-percent={percentStart}
>
  <Image src={img} alt={""} />
</li>
